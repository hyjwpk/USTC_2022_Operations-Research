# 实验一 单纯形法实验报告

## 线性规划模型的建立

​	设x1、x2、x3分别为甲糖果所用A、B、C原料的千克数，x4、x5、x6分别为乙糖果所用A、B、C原料的千克数，x7、x8、x9分别为丙糖果所用A、B、C原料的千克数。

​	根据题目条件，`目标函数`为

$$
maxz=(3.40-0.50)(x_1+x_2+x_3)+(2.85-0.40)(x_4+x_5+x_6)+(2.25-0.30)(x_7+x_8+x_9) \\
-2.00(x_1+x_4+x_7)-1.50(x_2+x_5+x_8)-1.00(x_3+x_6+x_9)\\=0.9x_1+1.4x_2+1.9x_3+0.45x_4+0.95x_5+1.45x_6-0.05x_7+0.45x_8+0.95x_9
$$

​	`约束条件`为

$$
\begin{cases}
 \frac{x_1}{x_1+x_2+x_3}\ge 0.6 \\
 \frac{x_3}{x_1+x_2+x_3}\le 0.2\\
 \frac{x_4}{x_4+x_5+x_6}\ge 0.15\\
 \frac{x_6}{x_4+x_5+x_6}\le 0.6\\
 \frac{x_9}{x_7+x_8+x_9}\le 0.5\\
 x_1+x_4+x_7\le 2000\\
 x_2+x_5+x_8\le 2500\\
 x_3+x_6+x_9\le 1200\\
 x_i\ge 0,\forall i\in [1,9]
\end{cases}
\Rightarrow 
\begin{cases}
 -0.4x_1+0.6x_2+0.6x_3\le 0\\
 -0.2x_1-0.2x_2+0.8x_3\le 0\\
 -0.85x_4+0.15x_5+0.15x_6\le 0\\
 -0.6x_4-0.6x_5+0.4x_6\le 0\\
 -0.5x_7-0.5x_8+0.5x_9\le 0\\
 x_1+x_4+x_7\le 2000\\
 x_2+x_5+x_8\le 2500\\
 x_3+x_6+x_9\le 1200\\
 x_i\ge 0,\forall i\in [1,9]
\end{cases}
$$

​	将`线性规划模型`化为`标准型`得到

$$
maxz=0.9x_1+1.4x_2+1.9x_3+0.45x_4+0.95x_5+1.45x_6-0.05x_7+0.45x_8+0.95x_9\\
\begin{cases}
 -0.4x_1+0.6x_2+0.6x_3+x_{10}=  0\\
 -0.2x_1-0.2x_2+0.8x_3+x_{11}= 0\\
 -0.85x_4+0.15x_5+0.15x_6+x_{12}= 0\\
 -0.6x_4-0.6x_5+0.4x_6+x_{13}= 0\\
 -0.5x_7-0.5x_8+0.5x_9+x_{14}= 0\\
 x_1+x_4+x_7+x_{15}= 2000\\
 x_2+x_5+x_8+x_{16}= 2500\\
 x_3+x_6+x_9+x_{17}= 1200\\
 x_i\ge 0,\forall i\in [1,17]
\end{cases} \qquad  \qquad  \qquad  \qquad  \qquad  \qquad  \qquad  \qquad  \qquad  \qquad  \quad
$$

## 实验方法与步骤

​	使用MATLAB建立`单纯形法矩阵计算模型`，模型中的基本公式如下

$$
\begin{cases}
 \sigma_{N}=C_{N}-C_{B}B^{-1}N\\
 \theta = min\left \{ \frac{(B^{-1}b)_i}{(B^{-1}P_k)_i} | (B^{-1}P_k)_i>0 \right  \}= \frac{(B^{-1}b)_l}{(B^{-1}P_k)_l}\\
 B^{-1}_{new}=EB^{-1}
\end{cases}
$$

​	对应的MATLAB代码如下

```matlab
sigma = Cn - Cb * B * N;

a = B * A(:,in);
theta = (B * b')./a;

E = eye(8);
P = B * A(:,in);
for i = 1:size(b,2)
    if (i==outpos)
        E(i,outpos) = 1/P(i);
    else
        E(i,outpos) = -P(i)/P(outpos);
    end
end
B = E*B;
```

​	为避免可能出现的循环采用`Bland规则`，计算`换入变量`与`换出变量`的代码如下

```matlab
in = 18;
for i=1:size(sigma,2)
    if ((sigma(i) > 0) && Xn(i) < in)
        in = Xn(i);
        inpos = i;
    end
end

outpos = find(theta == min(theta));
out = outpos;
for i=1:size(out)
    out(i) = Xb(out(i));
end
outpos = outpos(out == min(out));
out = Xb(outpos);
```

​	数据的`初始化`如下

```matlab
A = [-0.4 0.6 0.6 0 0 0 0 0 0      1 0 0 0 0 0 0 0;
     -0.2 -0.2 0.8 0 0 0 0 0 0     0 1 0 0 0 0 0 0;
     0 0 0 -0.85 0.15 0.15 0 0 0   0 0 1 0 0 0 0 0;
      0 0 0 -0.6 -0.6 0.4 0 0 0    0 0 0 1 0 0 0 0;
      0 0 0 0 0 0 -0.5 -0.5 0.5    0 0 0 0 1 0 0 0;
      1 0 0 1 0 0 1 0 0            0 0 0 0 0 1 0 0;
      0 1 0 0 1 0 0 1 0            0 0 0 0 0 0 1 0;
      0 0 1 0 0 1 0 0 1            0 0 0 0 0 0 0 1
      ];
b = [0 0 0 0 0 2000 2500 1200];
Xn = [1 2 3 4 5 6 7 8 9];
Xb = [10 11 12 13 14 15 16 17]; 
N = [-0.4 0.6 0.6 0 0 0 0 0 0      ;
     -0.2 -0.2 0.8 0 0 0 0 0 0     ;
     0 0 0 -0.85 0.15 0.15 0 0 0   ;
      0 0 0 -0.6 -0.6 0.4 0 0 0    ;
      0 0 0 0 0 0 -0.5 -0.5 0.5    ;
      1 0 0 1 0 0 1 0 0            ;
      0 1 0 0 1 0 0 1 0            ;
      0 0 1 0 0 1 0 0 1            ];
B = eye(8);
Cn = [0.9 1.4 1.9 0.45 0.95 1.45 -0.05 0.45 0.95];
Cb = [0 0 0 0 0 0 0 0];
```

## 实验结果

执行lab1.m的结果如下

```matlab
>> lab1
1526.666667 508.888889 508.888889 473.333333 1991.111111 691.111111 0.000000 0.000000 0.000000         6160
```
输出结果为`最优解`x1-x9的值，与`目标函数`的`最大值`

$$
\begin{cases}
 maxz=6160\\
 X = 
\begin{bmatrix}
  1526.7 & 508.9 & 508.9 & 473.3 & 1991.1 & 691.1 & 0 & 0 & 0
\end{bmatrix}^T
\end{cases}
$$

但单纯形法结束时某个非基变量检验数为0，继续以该非基变量作为换入变量，可得到一新`最优解`

$$
\begin{cases}
 maxz=6160\\
 X = 
\begin{bmatrix}
  1526.7 & 1017.8 & 0 & 473.3 & 1482.2 & 1200.0 & 0 & 0 & 0
\end{bmatrix}^T
\end{cases}
$$

这两个最优顶点连线上的任一点都是该线性规划问题的最优解
